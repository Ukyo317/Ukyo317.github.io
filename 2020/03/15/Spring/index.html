<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Swaggerswagger是一款让程序员更好的书写API文档的框架。 REST APIs文档生成工具。Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。 Referenceshttps://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project">
<meta property="og:type" content="article">
<meta property="og:title" content="Ukyo Chen&#39;s blogs">
<meta property="og:url" content="https://ukyo317.github.io/2020/03/15/Spring/index.html">
<meta property="og:site_name" content="Ukyo Chen&#39;s blogs">
<meta property="og:description" content="Swaggerswagger是一款让程序员更好的书写API文档的框架。 REST APIs文档生成工具。Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。 Referenceshttps://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://img-blog.csdn.net/20170827175556715?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20170827175340567?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://img-blog.csdn.net/20170827202033991?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="https://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project/image002.png">
<meta property="og:image" content="c:%5CUsers%5Ccheny%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1584232801104.png">
<meta property="og:image" content="https://pic4.zhimg.com/80/v2-ab2479317923472e06d5f3e0b8943944_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-c1e791200de645b39ed670f9b86109e8_1440w.jpg">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-da001bd5ae83cd8fbcca1dec0db8dc24_1440w.jpg">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-c1ac0f0772b5ddedafa44636e75b3ded_1440w.jpg">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/1/15/1684f7fabf207ba3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/1/15/1684f85bbaffeb7e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2019/1/15/1684f8df1ee94a56?imageView2/0/w/1280/h/960/format/webp/ignore-error/1">
<meta property="og:updated_time" content="2020-03-15T04:55:59.607Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ukyo Chen&#39;s blogs">
<meta name="twitter:description" content="Swaggerswagger是一款让程序员更好的书写API文档的框架。 REST APIs文档生成工具。Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。 Referenceshttps://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project">
<meta name="twitter:image" content="https://img-blog.csdn.net/20170827175556715?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ukyo317.github.io/2020/03/15/Spring/">





  <title> | Ukyo Chen's blogs</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ukyo Chen's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            Sitemap
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ukyo317.github.io/2020/03/15/Spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ukyo Chen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ukyo Chen's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline"></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-15T23:52:37+08:00">
                2020-03-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><p><code>swagger</code>是一款让程序员更好的书写API文档的框架。</p>
<p>REST APIs文档生成工具。Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project/index.html</a><br>在Spring Boot中集成</p>
<h2 id="rap-API文档工具"><a href="#rap-API文档工具" class="headerlink" title="rap API文档工具"></a>rap API文档工具</h2><p>请看，可以填写请求和相应的字段<br><img src="https://img-blog.csdn.net/20170827175556715?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>还可以选择字段对应的类型<br><img src="https://img-blog.csdn.net/20170827175340567?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>github地址为：<a href="https://github.com/thx/RAP" target="_blank" rel="noopener">https://github.com/thx/RAP</a><br>当然咯，<code>rap</code>不可能只有线上版本，肯定可以部署到私服上。<br><a href="https://github.com/thx/RAP/wiki/deploy_manual_cn" target="_blank" rel="noopener">https://github.com/thx/RAP/wiki/deploy_manual_cn</a></p>
<h2 id="生态使用图"><a href="#生态使用图" class="headerlink" title="生态使用图"></a>生态使用图</h2><p><img src="https://img-blog.csdn.net/20170827202033991?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaTY0NDgwMzg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="在Spring-Boot中的应用"><a href="#在Spring-Boot中的应用" class="headerlink" title="在Spring Boot中的应用"></a>在Spring Boot中的应用</h2><h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>1.通过在控制器类上增加<code>@Api</code> 注解，可以给控制器增加描述和标签信息。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api</span>(tags = <span class="string">"用户相关接口"</span>, description = <span class="string">"提供用户相关的 Rest API"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span></span></span><br></pre></td></tr></table></figure>

<p>2.通过在接口方法上增加 <code>@ApiOperation</code> 注解来展开对接口的描述，当然这个注解还可以指定很多内容，我们在下面的相关注解说明章节中详细解释。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation</span>(<span class="string">"新增用户接口"</span>)</span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addUser</span><span class="params">(@RequestBody User user)</span> </span>&#123;</span><br><span class="line">    ``<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.实体描述，我们可以通过<code>@ApiModel</code> 和 <code>@ApiModelProperty</code> 注解来对我们 API 中所涉及到的对象做描述。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel</span>(<span class="string">"用户实体"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"用户 id"</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.文档信息配置，Swagger 还支持设置一些文档的版本号、联系人邮箱、网站、版权、开源协议等等信息，但与上面几条不同的是这些信息不是通过注解配置，而是通过创建一个 ApiInfo 对象，并且使用 <code>Docket.appInfo()</code> 方法来设置，我们在 SwaggerConfig.java 类中新增如下内容即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Docket <span class="title">api</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">.select()</span><br><span class="line">            .apis(RequestHandlerSelectors.any())</span><br><span class="line">            .paths(PathSelectors.any())</span><br><span class="line">            .build()</span><br><span class="line">            .apiInfo(apiInfo());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ApiInfo(</span><br><span class="line">            <span class="string">"Spring Boot 项目集成 Swagger 实例文档"</span>,</span><br><span class="line">            <span class="string">"我的博客网站：https://itweknow.cn，欢迎大家访问。"</span>,</span><br><span class="line">            <span class="string">"API V1.0"</span>,</span><br><span class="line">            <span class="string">"Terms of service"</span>,</span><br><span class="line">            <span class="keyword">new</span> Contact(<span class="string">"名字想好没"</span>, <span class="string">"https://itweknow.cn"</span>, <span class="string">"gancy.programmer@gmail.com"</span>),</span><br><span class="line">                <span class="string">"Apache"</span>, <span class="string">"http://www.apache.org/"</span>, Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经过上面的步骤，文档将会变成下图的样子，现在看起来就清楚很多了。</p>
<p><img src="https://www.ibm.com/developerworks/cn/java/j-using-swagger-in-a-spring-boot-project/image002.png" alt="img"></p>
<h1 id="LDAP用法"><a href="#LDAP用法" class="headerlink" title="LDAP用法"></a>LDAP用法</h1><h2 id="查询："><a href="#查询：" class="headerlink" title="查询："></a>查询：</h2><p>Person.java</p>
<p>Person中字段为<strong>需要从Ldap中查询的数据字段</strong>，利用注解@Attribute(name=“xx”)进行注解,Entry中定义的<strong>objectClass和base为Ldap中数据资源的定位信息</strong>。查询的时候可以作为返回对象来接收数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span>(objectClasses = &#123;<span class="string">"bicPersonExt"</span>, <span class="string">"bicPerson"</span>&#125;, base = <span class="string">"ou=person,dc=coreservice"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span></span><br><span class="line">    <span class="keyword">private</span> String personId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 人员姓名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span>(name = <span class="string">"cn"</span>)</span><br><span class="line">    <span class="keyword">private</span> String personName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组织ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span>(name = <span class="string">"orgId"</span>)</span><br><span class="line">    <span class="keyword">private</span> String orgId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 性别</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span>(name = <span class="string">"sex"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 电话</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span>(name = <span class="string">"mobile"</span>)</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span>(name = <span class="string">"email"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Attribute</span>(name = <span class="string">"jobNo"</span>)</span><br><span class="line">    <span class="keyword">private</span> String jobNo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="IOC和AOP"><a href="#IOC和AOP" class="headerlink" title="IOC和AOP"></a>IOC和AOP</h1><p>IOC</p>
<p>工厂模式的应用</p>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><h3 id="References-1"><a href="#References-1" class="headerlink" title="References:"></a>References:</h3><p><a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/aop.html#aop-schema" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/aop.html#aop-schema</a></p>
<h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><p><strong>Aspect</strong>:</p>
<p>Two Methods: </p>
<ol>
<li>In Spring AOP, aspects are implemented using regular classes (the <a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/aop.html#aop-schema" target="_blank" rel="noopener">schema-based approach</a>)</li>
<li>regular classes annotated with the <code>@Aspect</code> annotation (the <a href="https://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/aop.html#aop-ataspectj" target="_blank" rel="noopener"><code>@AspectJ</code> style</a>).</li>
</ol>
<p><strong>Join Point</strong></p>
<p>a point during the execution of a program, such as the execution of a method or the handling of an exception.<br>In Spring AOP, a join point <em>always</em> represents <strong>a method execution</strong>.</p>
<p><strong>Advice</strong></p>
<p>action taken by an aspect at a particular join point. Different types of advice include “around,” “before” and “after” advice.</p>
<p>Many AOP frameworks, including Spring, model an advice as an <strong><em>interceptor</em></strong>, maintaining <strong>a chain of interceptors</strong> <em>around</em> the join point.</p>
<p><strong>Pointcut</strong>(不太理解，以下都不太理解)</p>
<p>a predicate that matches join points. Advice is associated with a pointcut expression and runs at any join point matched by the pointcut (for example, the execution of a method with a certain name).</p>
<p>The concept of join points as matched by pointcut expressions is central to AOP, and Spring uses the <strong>AspectJ pointcut expression language</strong> by default.</p>
<p><strong>Introduction</strong></p>
<p><strong>Target object</strong></p>
<p><strong>AOP proxy</strong></p>
<p>an object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy will be a JDK dynamic proxy or a CGLIB proxy</p>
<p><strong>Weaving</strong></p>
<p>linking aspects with other application types or objects to create an advised object. This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime.</p>
<h1 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h1><h2 id="References-2"><a href="#References-2" class="headerlink" title="References"></a>References</h2><p><a href="https://www.zhihu.com/question/65502802" target="_blank" rel="noopener">https://www.zhihu.com/question/65502802</a></p>
<h2 id="从单体应用到微服务架构"><a href="#从单体应用到微服务架构" class="headerlink" title="从单体应用到微服务架构"></a>从单体应用到微服务架构</h2><h3 id="单体："><a href="#单体：" class="headerlink" title="单体："></a>单体：</h3><ul>
<li>相同业务逻辑的重复代码</li>
<li>数据有时候通过数据库共享，有时通过接口调用传输，接口调用关系复杂。</li>
<li>（比如？）单个应用为了给其他应用提供接口，渐渐地越改越大，包含了很多本来就不属于它的逻辑。应用边界模糊，功能归属混乱。（比如？）</li>
<li>（保障级别？）管理后台在一开始的设计中保障级别较低。加入数据分析和促销管理相关功能后出现性能瓶颈，影响了其他应用。（保障级别？）</li>
<li>所有应用都在一个数据库上操作，数据库出现性能瓶颈。特别是数据分析跑起来的时候，数据库性能急剧下降。</li>
<li>开发、测试、部署、维护愈发困难。即使只改动一个小功能，也需要整个应用一起发布。</li>
</ul>
<h3 id="单一数据库："><a href="#单一数据库：" class="headerlink" title="单一数据库："></a>单一数据库：</h3><ul>
<li>数据库成为性能瓶颈，并且有单点故障的风险。</li>
<li>数据管理趋向混乱。即使一开始有良好的模块化设计，随着时间推移，总会有一个服务直接从数据库取另一个服务的数据的现象。</li>
<li>数据库表结构可能被多个服务依赖，牵一发而动全身，很难调整。</li>
</ul>
<h3 id="数据库拆分"><a href="#数据库拆分" class="headerlink" title="数据库拆分"></a>数据库拆分</h3><h4 id="可能的问题"><a href="#可能的问题" class="headerlink" title="可能的问题"></a>可能的问题</h4><ul>
<li>跨库级联的需求</li>
<li>通过服务查询数据颗粒度的粗细问题等</li>
</ul>
<h3 id="服务拆分的问题"><a href="#服务拆分的问题" class="headerlink" title="服务拆分的问题"></a>服务拆分的问题</h3><ul>
<li>微服务架构整个应用分散成多个服务，<u>定位故障点</u>非常困难。</li>
<li>稳定性下降。服务数量变多导致其中一个服务出现故障的概率增大，并且<u>一个服务故障可能导致整个系统挂掉</u>。事实上，在大访问量的生产场景下，故障总是会出现的。</li>
<li>服务数量非常多，部署、管理的工作量很大。</li>
<li>开发方面：如何保证各个服务在<u>持续开发的情况下</u>仍然保持协同合作。</li>
<li>测试方面：服务拆分后，几乎所有功能都会涉及多个服务。原本<u>单个程序的测试变为服务间调用的测试</u>。测试变得更加复杂。</li>
</ul>
<h3 id="微服务问题的解决"><a href="#微服务问题的解决" class="headerlink" title="微服务问题的解决"></a>微服务问题的解决</h3><ul>
<li>量减少故障发生的概率</li>
<li>降低故障造成的影响</li>
</ul>
<p><img src="C:%5CUsers%5Ccheny%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1584232801104.png" alt="1584232801104"></p>
<h4 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h4><h5 id="监控指标："><a href="#监控指标：" class="headerlink" title="监控指标："></a>监控指标：</h5><ul>
<li>Redis缓存一般监控占用内存值、网络流量</li>
<li>数据库监控连接数、磁盘空间</li>
<li>业务服务监控并发数、响应延迟、错误率</li>
</ul>
<h4 id="策略："><a href="#策略：" class="headerlink" title="策略："></a>策略：</h4><ul>
<li>如果做一个大而全的监控系统来监控各个组件是不大现实的，而且扩展性会很差。</li>
<li>一般的做法是让各个组件提供报告自己当前状态的接口（metrics接口），这个接口输出的数据格式应该是一致的。然后部署一个指标采集器组件，定时从这些接口获取并保持组件状态，同时提供查询服务。最后还需要一个UI，从指标采集器查询各项指标，绘制监控界面或者根据阈值发出告警。</li>
</ul>
<h4 id="开源组件："><a href="#开源组件：" class="headerlink" title="开源组件："></a>开源组件：</h4><ul>
<li>采用Prometheus作为指标采集器</li>
<li>Grafana配置监控界面和邮件告警</li>
<li>RedisExporter和MySQLExporter</li>
</ul>
<p><img src="https://pic4.zhimg.com/80/v2-ab2479317923472e06d5f3e0b8943944_1440w.jpg" alt="img"></p>
<h3 id="定位问题-链路跟踪"><a href="#定位问题-链路跟踪" class="headerlink" title="定位问题 - 链路跟踪"></a><strong>定位问题 - 链路跟踪</strong></h3><p>在微服务架构下，一个用户的请求往往涉及<u><strong>多个内部服务调用</strong></u>。为了方便定位问题，需要能够记录每个用户请求时，微服务内部产生了多少<u>服务调用，及其调用关系</u>。这个叫做链路跟踪。</p>
<p><img src="https://pic2.zhimg.com/80/v2-c1e791200de645b39ed670f9b86109e8_1440w.jpg" alt="img"></p>
<p>从图中可以看到，这是一个用户访问productpage页面的请求。在请求过程中，productpage服务顺序调用了details和reviews服务的接口。而reviews服务在响应过程中又调用了ratings的接口。整个链路跟踪的记录是一棵树：</p>
<p><img src="https://pic2.zhimg.com/80/v2-da001bd5ae83cd8fbcca1dec0db8dc24_1440w.jpg" alt="img"></p>
<p>要实现链路跟踪，每次服务调用会在HTTP的HEADERS中记录至少记录四项数据：</p>
<ul>
<li>traceId：traceId标识一个用户请求的调用链路。具有相同traceId的调用属于同一条链路。</li>
<li>spanId：标识一次服务调用的ID，即链路跟踪的节点ID。</li>
<li>parentId：父节点的spanId。</li>
<li>requestTime &amp; responseTime：请求时间和响应时间。</li>
</ul>
<p>另外，还需要调用日志收集与存储的组件，以及展示链路调用的UI组件。</p>
<p><img src="https://pic1.zhimg.com/80/v2-c1ac0f0772b5ddedafa44636e75b3ded_1440w.jpg" alt="img"></p>
<p>理论依据（谷歌出品）：<br><a href="http://bigbully.github.io/Dapper-translation/" target="_blank" rel="noopener">http://bigbully.github.io/Dapper-translation/</a></p>
<h4 id="zipkin（Dapper实现）"><a href="#zipkin（Dapper实现）" class="headerlink" title="zipkin（Dapper实现）"></a>zipkin（Dapper实现）</h4><p>一个独立的分布式追踪系统，客户端存在于应用中（即各服务中），应具备追踪信息生成、采集发送等功能，而服务端应该包含以下基本的三个功能：</p>
<ul>
<li>信息收集：用来收集各服务端采集的信息，并对这些信息进行梳理存储、建立索引。</li>
<li>数据存储：存储追踪数据。</li>
<li>查询服务：提供查询请求链路信息的接口。</li>
</ul>
<p>zipkin 整体结构图如下：</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/1/15/1684f7fabf207ba3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="zipkin 结构图"></p>
<p>zipkin(服务端)包含四个组件，分别是collector、storage、search、web UI。</p>
<ul>
<li>collector 就是信息收集器,作为一个守护进程，它会时刻等待客户端传递过来的追踪数据，对这些数据进行验证、存储以及创建查询需要的索引。</li>
<li>storage  是存储组件。zipkin 默认直接将数据存在内存中，此外支持使用Cassandra、ElasticSearch 和 Mysql。</li>
<li>search 是一个查询进程，它提供了简单的JSON API来供外部调用查询。</li>
<li>web UI 是zipkin的服务端展示平台，主要调用search提供的接口，用图表将链路信息清晰地展示给开发人员。</li>
</ul>
<p>两个概念：</p>
<p>Trace Span</p>
<p>一个请求到达应用后所调用的所有服务所有服务组成的调用链就像一个树结构（如下图），我们<strong>追踪</strong>这个调用<strong>链路</strong>得到的这个树结构可以称之为<strong>Trace</strong>。</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/1/15/1684f85bbaffeb7e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>在一次Trace中，每个服务的<strong>每一次调用</strong>，就是一个<strong>基本工作单元</strong>，就像上图中的每一个树节点，称之为<strong>span</strong>。每一个span都有一个<strong>id作为唯一标识</strong>，同样每一次Trace都会生成一个<strong>traceId在span中作为追踪标识</strong>，另外再通过一个<strong>parentId标明本次调用的发起者</strong>（就是发起者的span-id）。</p>
<p>当span有了上面三个标识后，就可以很清晰的将多个span进行梳理串联，最终归纳出一条完整的跟踪链路。</p>
<p>此外，span还会有其他数据，比如：名称、节点上下文、时间戳以及K-V结构的tag信息等等。</p>
<p>（Zipkin v1核心注解如“cs”和“sr”已被Span.Kind取代，详情查看<a href="https://zipkin.io/zipkin-api/#/" target="_blank" rel="noopener">zipkin-api</a>，本文会在入门的demo介绍完后对具体的Span数据模型进行说明）。</p>
<h5 id="追踪流程"><a href="#追踪流程" class="headerlink" title="追踪流程"></a>追踪流程</h5><ul>
<li>每个span需要的基本信息何时生成？</li>
<li>哪些信息需要随着服务调用传递给服务提供方？</li>
<li>什么时候发送span至zipkin 服务端？</li>
<li>以何种方式发送span?</li>
</ul>
<p>一个 span 表示一次服务调用，那么追踪器必定是被服务调用发起的动作触发，生成基本信息，同时为了追踪服务提供方对其他服务的调用情况，便需要传递本次追踪链路的traceId和本次调用的span-id。服务提供方完成服务将结果响应给调用方时，需要根据调用发起时记录的时间戳与当前时间戳计算本次服务的持续时间进行记录，至此这次调用的追踪span完成，就可以发送给zipkin服务端了。</p>
<p>但是需要注意的是，发送span给zipkin collector不得影响此次业务结果，其发送成功与否跟业务无关，因此这里需要采用异步的方式发送，防止追踪系统发送延迟与发送失败导致用户系统的延迟与中断。下图就表示了一次http请求调用的追踪流程（基于zipkin官网提供的流程图）： </p>
<p><img src="https://user-gold-cdn.xitu.io/2019/1/15/1684f8df1ee94a56?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="一次http请求调用的追踪流程"></p>
<p> 可以看出服务A请求服务B时先被追踪器拦截，记录tag信息、时间戳，同时将追踪标识添加进http header中传递给服务B，在服务B响应后，记录持续时间，最终采取异步的方式发送给zipkin收集器。span从被追踪的服务传送到Zipkin收集器有三种主要的传送方式：http、Kafka以及Scribe（Facebook开源的日志收集系统）。</p>
<h5 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h5><p><a href="https://juejin.im/post/5c3d4df0f265da61307517ad#heading-9" target="_blank" rel="noopener">https://juejin.im/post/5c3d4df0f265da61307517ad#heading-9</a></p>
<h5 id="后续改进"><a href="#后续改进" class="headerlink" title="后续改进"></a>后续改进</h5><p>追踪信息是全量收集还是采样收集，设置什么样的采样频率，异步发送span使用http还是kafka，这些问题都是需要在生产环境中根据实际场景综合考量的。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/15/Multiprocess/" rel="next" title>
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/03/15/Unix网络编程/" rel="prev" title>
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Ukyo Chen</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Swagger"><span class="nav-number">1.</span> <span class="nav-text">Swagger</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">1.1.</span> <span class="nav-text">References</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rap-API文档工具"><span class="nav-number">1.2.</span> <span class="nav-text">rap API文档工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#生态使用图"><span class="nav-number">1.3.</span> <span class="nav-text">生态使用图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在Spring-Boot中的应用"><span class="nav-number">1.4.</span> <span class="nav-text">在Spring Boot中的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注解"><span class="nav-number">1.4.1.</span> <span class="nav-text">注解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LDAP用法"><span class="nav-number">2.</span> <span class="nav-text">LDAP用法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查询："><span class="nav-number">2.1.</span> <span class="nav-text">查询：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IOC和AOP"><span class="nav-number">3.</span> <span class="nav-text">IOC和AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AOP"><span class="nav-number">3.1.</span> <span class="nav-text">AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#References-1"><span class="nav-number">3.1.1.</span> <span class="nav-text">References:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Concepts"><span class="nav-number">3.1.2.</span> <span class="nav-text">Concepts</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#微服务"><span class="nav-number">4.</span> <span class="nav-text">微服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#References-2"><span class="nav-number">4.1.</span> <span class="nav-text">References</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从单体应用到微服务架构"><span class="nav-number">4.2.</span> <span class="nav-text">从单体应用到微服务架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单体："><span class="nav-number">4.2.1.</span> <span class="nav-text">单体：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单一数据库："><span class="nav-number">4.2.2.</span> <span class="nav-text">单一数据库：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库拆分"><span class="nav-number">4.2.3.</span> <span class="nav-text">数据库拆分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#可能的问题"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">可能的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务拆分的问题"><span class="nav-number">4.2.4.</span> <span class="nav-text">服务拆分的问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#微服务问题的解决"><span class="nav-number">4.2.5.</span> <span class="nav-text">微服务问题的解决</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#监控"><span class="nav-number">4.2.5.1.</span> <span class="nav-text">监控</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#监控指标："><span class="nav-number">4.2.5.1.1.</span> <span class="nav-text">监控指标：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#策略："><span class="nav-number">4.2.5.2.</span> <span class="nav-text">策略：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开源组件："><span class="nav-number">4.2.5.3.</span> <span class="nav-text">开源组件：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定位问题-链路跟踪"><span class="nav-number">4.2.6.</span> <span class="nav-text">定位问题 - 链路跟踪</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zipkin（Dapper实现）"><span class="nav-number">4.2.6.1.</span> <span class="nav-text">zipkin（Dapper实现）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#追踪流程"><span class="nav-number">4.2.6.1.1.</span> <span class="nav-text">追踪流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#代码部分"><span class="nav-number">4.2.6.1.2.</span> <span class="nav-text">代码部分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#后续改进"><span class="nav-number">4.2.6.1.3.</span> <span class="nav-text">后续改进</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ukyo Chen</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
